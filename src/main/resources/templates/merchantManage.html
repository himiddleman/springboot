<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>商户入网</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div th:include="header :: header"></div>
    <div th:include="menu :: menu"></div>
    <!--查询页面 -->
    <div class="layui-body">
        <!--面包屑-->
        <span class="layui-breadcrumb">
          <a href="">商户管理</a>
          <a><cite>商户入网</cite></a>
        </span>
        <!--查询条件-->
        <div class="layui-form-item" style="margin-top: 20px;">
            <div class="layui-inline">
                <label class="layui-form-label">用户名：</label>
                <div class="layui-input-inline" style="width: 200px;">
                    <input type="text" id="username" placeholder="请输入用户名" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-label">职业：</label>
                <div class="layui-input-inline" style="width: 200px;">
                    <input type="text" id="position" placeholder="请输入职业" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formDemo" id="queryBtn">查询</button>
                <button class="layui-btn layui-btn-normal" id="addBtn">新增</button>
                <button type="reset" class="layui-btn layui-btn-primary" id="resetParam">重置</button>
            </div>
        </div>
        <!-- 数据展示 table框 -->
        <table class="layui-hide" id="test" lay-filter="test"></table>
    </div>
    <div th:include="footer :: footer"></div>

    <!--新增页面 -->
    <form class="layui-form" style="display:none;margin: 10px;" id="addtForm">
        <div class="layui-form-item">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-block">
                <input type="text" id="addUsername" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">积分</label>
            <div class="layui-input-inline">
                <input type="text" id="addExperience" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">辅助文字</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">评分</label>
            <div class="layui-input-inline">
                <input type="text" id="addScore" required lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">财富</label>
            <div class="layui-input-inline">
                <input type="text" id="addWealth" required lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">城市</label>
            <div class="layui-input-block">
                <select id="addCity" lay-verify="required">
                    <option value=""></option>
                    <option value="0">北京</option>
                    <option value="1">上海</option>
                    <option value="2">广州</option>
                    <option value="3">深圳</option>
                    <option value="4">杭州</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">职业</label>
            <div class="layui-input-block">
                <input type="checkbox" name="addClassify" title="程序员">
                <input type="checkbox" name="addClassify" title="阅读" checked>
                <input type="checkbox" name="addClassify" title="发呆">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">开关</label>
            <div class="layui-input-block">
                <input type="checkbox" id="addSwitch" lay-skin="switch">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block">
                <input type="radio" name="addSex" value="男" title="男">
                <input type="radio" name="addSex" value="女" title="女" checked>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">签名</label>
            <div class="layui-input-block">
                <textarea name="addSign" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="addFilter" id="addSubmit">提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
    <!--编辑页面-->
    <form class="layui-form" style="display:none;margin: 10px;" id="editForm">
        <div class="layui-form-item">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-block">
                <input type="text" id="editUsername" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">积分</label>
            <div class="layui-input-inline">
                <input type="text" id="editExperience" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">辅助文字</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">评分</label>
            <div class="layui-input-inline">
                <input type="text" id="editScore" required lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">财富</label>
            <div class="layui-input-inline">
                <input type="text" id="editWealth" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">城市</label>
            <div class="layui-input-block">
                <select id="editCity" lay-verify="required">
                    <option value=""></option>
                    <option value="0">北京</option>
                    <option value="1">上海</option>
                    <option value="2">广州</option>
                    <option value="3">深圳</option>
                    <option value="4">杭州</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">职业</label>
            <div class="layui-input-block">
                <input type="checkbox" name="editClassify" title="程序员">
                <input type="checkbox" name="editClassify" title="阅读" checked>
                <input type="checkbox" name="editClassify" title="发呆">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">开关</label>
            <div class="layui-input-block">
                <input type="checkbox" id="switch" lay-skin="switch">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block">
                <input type="radio" name="editSex" value="男" title="男">
                <input type="radio" name="editSex" value="女" title="女" checked>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">签名</label>
            <div class="layui-input-block">
                <textarea name="editSign" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="editFilter" id="editSubmit">提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
    <!--操作菜单页面-->
    <div style="display: none;" id="operator">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </div>
</div>
</body>
<script src="/static/layui/layui.js"></script>
<script th:inline="none">
    //element 展示左边菜单栏; 预加载需要使用的模块
    //由于layer弹层依赖jQuery，所以可以直接得到
    layui.use(['table', 'element', 'laypage', 'layer', 'form'], function () {
        var table = layui.table;
        var $ = layui.$;
        var layer = layui.layer;
        var form = layui.form;
        //抽取查询方法
        var search = function () {
            table.render({
                //表格生成的位置：#ID
                elem: '#test',
                //请求地址
                url: '/web/getList',
                //是否分页
                page: true,
                //请求参数
                where: {
                    username: $("#username").val(),
                    position: $("#position").val()
                },
                //分页信息
                request: {
                    pageName: 'pageNum',
                    limitName: 'pageSize'
                },
                //设置返回的属性值，依据此值进行解析
                response: {
                    statusName: 'code',
                    statusCode: 200,
                    msgName: 'msg',
                    dataName: 'data'
                },
                //每页展示的条数
                limits: [2, 4, 6],
                //每页默认显示的数量
                limit: 2,
                //单元格设置
                cols: [[
                    {field: 'id', width: 80, title: 'ID', sort: true},
                    {field: 'username', width: 80, title: '用户名'},
                    {field: 'sex', width: 80, title: '性别', sort: true},
                    {field: 'city', width: 80, title: '城市'},
                    {field: 'sign', title: '签名', width: 120},
                    {field: 'experience', title: '积分', sort: true},
                    {field: 'score', title: '评分', sort: true},
                    {field: 'classify', title: '职业'},
                    {field: 'wealth', width: 80, title: '财富', sort: true},
                    {fixed: 'right', title: '操作', toolbar: '#operator', width: 120}
                ]]
            });
        };
        //页面加载就查询列表
        search();
        //条件查询
        $("#queryBtn").on("click", function () {
            var index = layer.alert("立即提交", function () {
                layer.close(index);
                search();
            })

        });

        //重置参数
        $("#resetParam").on("click", function () {
            $("#username").val("");
            $("#position").val("");
            layer.alert("参数清除");
        });

        //进行编辑操作
        $("#editSubmit").on("click", function () {
            $.ajax({
                url: '/web/editById',
                type: 'post',
                data: {
                    id: '001'
                },
                async: false,
                dataType: 'json',
                success: function (data) {
                    if (data.code == "200") {
                        var index = layer.alert("编辑成功", function () {
                            //点击确认按钮执行回调函数
                            layer.closeAll();
                            search();
                        });
                    } else {
                        layer.alert("编辑失败！");
                    }
                },
                error: function () {
                    layer.alert("编辑失败，请重试！");
                }
            });
        });

        $("#addBtn").on("click", function () {
            openModal("addForm");
            $.ajax({
                url: '/web/add',
                type: 'post',
                data: {
                    id: '001'
                },
                async: false,
                dataType: 'json',
                success: function (data) {
                    if (data.code == "200") {
                        var index = layer.alert("添加成功", function () {
                            //点击确认按钮执行回调函数
                            layer.closeAll();
                            search();
                        });
                    } else {
                        layer.alert("添加失败！");
                    }
                },
                error: function () {
                    layer.alert("添加失败，请重试！");
                }
            })
        });

        //监听行工具事件
        table.on('tool(test)', function (obj) {
            //获取所在行的数据
            var data = obj.data;
            //删除
            if (obj.event === 'del') {
                var index = layer.confirm('确定删除？', function () {
                    $.ajax({
                        url: '/web/delById',
                        type: 'post',
                        data: {
                            id: data.id
                        },
                        dataType: 'json',
                        success: function (data) {
                            if (data.code == "200") {
                                layer.close(index);
                                search();
                            } else {
                                layer.alert("删除失败！");
                            }
                        },
                        error: function () {
                            layer.alert("删除失败，请重试！");
                        }
                    });
                });
                //编辑
            } else if (obj.event === 'edit') {
                //先通过后台查询数据，渲染页面后打开模态框
                $.ajax({
                    url: '/web/getById',
                    type: 'get',
                    data: {
                        id: data.id
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.code == "200") {
                            var myData = data.data[0];
                            $("#editUsername").val(myData.username);
                            $("#editExperience").val(myData.experience);
                            $("#editScore").val(myData.score);
                            $("#editWealth").val(myData.wealth);
                        } else {
                            layer.alert("查询失败！");
                        }
                    },
                    error: function () {
                        layer.alert("查询失败，请重试！");
                    }
                });
                //打开模态框
                openModal("editForm");
            }
        });

        //监听form表单提交事件 防止页面跳转
        form.on('submit(editFilter)', function (data) {
            return false;
        });

        //打开模态框
        function openModal(pageName) {
            layer.open({
                title: '编辑',
                content: $('#' + pageName),
                area: ['700px', '450px'],
                //点击遮罩关闭窗口
                // shadeClose:true,
                //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                type: 1
            });
        }
    });
</script>
</html>